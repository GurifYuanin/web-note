<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>事件</title>
	<link rel="stylesheet" href="../css/normalize.css">
	<link rel="stylesheet" href="../css/styles/default.css">
	<link rel="stylesheet" href="../css/sidebar.css">
	<script src="../js/jquery-3.2.1-compressed.js"></script>
	<script src="../js/highlight.pack.js"></script>
	<script src="../js/sidebar.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
	<aside id="sidebar">
		<section id="catalog">
			<img id="hideCatalog" src="../images/catalog.png" alt="加载失败">
			目录
		</section>
	</aside>
	<div id="showCatalog">
		<img src="../images/arrow.png">
	</div>
	<article id="container">
		<hgroup>
			<h1 id="title">事件</h1>
		</hgroup>
		<section>
			<h2>定义</h2>
			<p>
				事件是指在 HTML 元素上触发某一条件后执行的某种动作。作在 Javascript 中，事件可以分为：
				<ul>
					<li>UI 事件</li>
					<li>焦点事件</li>
					<li>鼠标事件</li>
					<li>键盘事件</li>
				</ul>
				相关概念：
				<ul>
					<li>事件名：事件的名字，如 click （鼠标单击）、 input（键盘输入）、focus（焦点）等</li>
					<li>事件处理程序：触发事件后执行的一段脚本代码（通常是一个函数）</li>
					<li>事件流：事件发生顺序</li>
				</ul>
			</p>
		</section>
		<section>
			<h2>事件流</h2>
			<p>
				由于 HTML 中元素可以相互包含，用户在触发某个事件的时候（如进行点击）就需要判断是在哪个元素上触发。例如
				<pre><code class="html">
&lt;div&gt;
	&lt;p&gt;点击我&lt;/p&gt;
&lt;/div&gt;
				</code></pre>
				当用户点击 p 元素时，是该先触发 p 上的事件，还是先触发 div 上的事件？<br>
				事件流是描述事件的发生顺序<sup>[1]</sup>。“DOM2级事件”规定事件流包括三个阶段：
				<ol>
					<li>事件捕获阶段（网景提出的事件流）</li>
					<li>处于目标阶段</li>
					<li>事件冒泡阶段（ IE 的事件流）</li>
				</ol>
				<div class="tip">
					在 javascript 中，通过<span class="definition"> target.addEventListener(eventName, function, useCapture) </span>来为 HTML 元素添加事件，第三个参数表示是否使用事件捕获机制，true 则为事件捕获，false（默认）为事件冒泡。
				</div>
				<div>
					<p>
						<h3>事件捕获</h3>
						事件捕获是网景提出的一种事件流，其思想是最底（外）层的元素（即 document）应该先接收到事件，再逐级传递给最顶（内）层的元素（被点击的元素）。
						<pre><code class="html">
&lt;style&gt;
	#outer{
		background-color: #ff0;
		height: 100px;
		width: 100px;
	}
	 #inner {
		background-color: #f0f;
		height: 50px;
		width: 50px;
	}
&lt;/style&gt;
&lt;div id="outer"&gt;
	&lt;div id="inner"&gt;点击我&lt;/div&gt;
&lt;/div&gt;
&lt;script&gt;
	var outer = document.getElementById('outer');
	var inner = document.getElementById('inner');
	document.addEventListener('click', function() {
		console.log('document');
	}, true);
	outer.addEventListener('click', function() {
		console.log('outer');
	}, true);
	inner.addEventListener('click', function() {
		console.log('inner');
	}, true);
&lt;/script&gt;
						</code></pre>
						<style>
							#outer{
								background-color: #ccc;
								height: 100px;
							}
							 #inner {
								background-color: #888;
								height: 50px;
							}
						</style>
						<div id="outer">
							<div id="inner">点击我</div>
						</div>
						<script>
							var outer = document.getElementById('outer');
							var inner = document.getElementById('inner');
							function logDoc() {
								console.log('document');
							}
							document.addEventListener('click', logDoc, true);
							outer.addEventListener('click', function() {
								console.log('outer');
							}, true);
							inner.addEventListener('click', function() {
								inner.innerHTML = '按 F12 打开控制台查看消息';
								console.log('inner');
							}, true);
						</script>
						document 会先接收到事件输出<span class="definition"> document </span>，之后 id 为 outer 的 div 元素也接收到事件输出<span class="definition"> outer </span>，最后 id 为 inner 的 div 元素才输出<span class="definition"> inner </span>。
						<figure>
							<img src="../images/event_capture.jpg">
							<figcaption class="description"> 事件捕获顺序（上先下后） </figcaption>
						</figure>
					</p>
					<p>
						<h3>事件冒泡</h3>
						事件冒泡与事件捕获相反，是先由当前元素（最顶层）开始接收事件，然后逐步传递到根元素（document），也是大多数浏览器默认支持的事件触发顺序。
						<style type="text/css">
							#out {
								height: 100px;
								background-color: #ccc;
							}
							#in {
								height: 50px;
								background-color: #888;
							}
						</style>
						<div id="out">
							<div id="in">再次点击我</div>
						</div>
						<script type="text/javascript">
							var outEl = document.getElementById('out');
							var inEl = document.getElementById('in');
							outEl.addEventListener('click', function(){
								console.log('outer');
							}, false);
							inEl.addEventListener('click', function(){
								console.clear();
								console.log('inner');
								inEl.innerHTML = '按 F12 查看控制台消息';
							}, false);
						</script>
						<figure>
							<img src="../images/event_bubble.jpg">
							<figcaption class="description"> 事件冒泡顺序（为了与前文避免冲突， document 没有注册冒泡事件） </figcaption>
						</figure>
					</p>
					<p>
						<h3>DOM2级事件流</h3>
						DOM2级事件流把事件触发顺序分成了三个阶段，先触发事件捕获（从 document 到目标元素），处于目标阶段（在目标元素上执行相应代码），事件冒泡（从目标元素到 document ）。
						<pre><code class="html">
&lt;style type="text/css"&gt;
	#d1 {
		height: 100px;
		background-color: #ccc;
	}
	#d2 {
		height: 50px;
		background-color: #888;
	}
&lt;/style&gt;
&lt;div id="d1"&gt;
	&lt;div id="d2"&gt;点我&lt;/div&gt;
&lt;/div&gt;
&lt;script type="text/javascript"&gt;
	var d1 = document.getElementById('d1');
	var d2 = document.getElementById('d2');
	d1.addEventListener('click', function(){
		console.log('d1 捕获');
	}, true);
	d1.addEventListener('click', function(){
		console.log('d1 冒泡');
	}, false);
	d2.addEventListener('click', function(){
		console.log('d2 捕获');
	}, true);
	d2.addEventListener('click', function(){
		console.log('d2 冒泡');
	}, false);
&lt;/script&gt;
						</code></pre>
						<style type="text/css">
							#d1 {
								height: 100px;
								background-color: #ccc;
							}
							#d2 {
								height: 50px;
								background-color: #888;
							}
						</style>
						<div id="d1">
							<div id="d2">点我</div>
						</div>
						<script type="text/javascript">
							var d1 = document.getElementById('d1');
							var d2 = document.getElementById('d2');
							d1.addEventListener('click', function(){
								console.clear();
								console.log('d1 捕获');
								d2.innerHTML = '按 F12 ...';
							}, true);
							d1.addEventListener('click', function(){
								console.log('d1 冒泡');
							}, false);
							d2.addEventListener('click', function(){
								console.log('d2 捕获');
							}, true);
							d2.addEventListener('click', function(){
								console.log('d2 冒泡');
							}, false);
						</script>
						<figure  style="text-align: center;">
							<img src="../images/event_dom2.jpg">
							<figcaption class="description"> 完整的事件流（省略 document ） </figcaption>
						</figure>
					</p>
				</div>
			</p>
		</section>
		<section>
			<h2>事件对象</h2>
			<p>
				事件处理程序为一个函数，函数的形参会自动传入一个 event 对象，该对象在不同事件中有不同属性，其通用属性有：
				<ul>
					<li>detail：事件相关细节信息</li>
					<li>eventPhase：事件流所在阶段</li>
					<li>type：事件的类型</li>
					<li>target：触发事件的 HTML 元素</li>
					<li>srcElement：触发事件的 HTML 元素（IE）</li>
					<li>currentTarget：执行事件处理程序的 HTML 元素</li>
					<li>bubbles：事件是否冒泡</li>
					<li>stopProgagation()：取消事件进一步捕获或冒泡</li>
					<li>cancelBubble：设置为 true 时取消事件冒泡（IE）</li>
					<li>stopImmediatePropagation()：取消事件进一步捕获或冒泡、阻止事件处理程序被调用</li>
					<li>cancelable：是否允许取消事件默认行为</li>
					<li>preventDefault()：取消事件默认行为</li>
					<li>returnValue：设置为 false 时取消事件默认行为（IE）</li>
					<li>defaultPrevented：是否已经取消事件默认行为</li>
				</ul>
				其中只有<span class="definition"> cancelBubble </span>和<span class="definition"> returnValue </span>为读写，其余都是只读属性。
			</p>
		</section>
		<section>
			<h2>UI 事件</h2>
			<p>
				常用的 UI 事件包括：
				<ul>
					<li>load：window、iframe、img 或嵌入内容加载完毕后触发</li>
					<li>DOMContentLoaded：DOM 树构建后触发，可添加在 window 或 document 上（HTML5 事件）</li>
					<li>unload：window、iframe或嵌入内容卸载完毕后触发</li>
					<li>beforeunload：页面被卸载前触发，询问消息设置给 event.returnValue 并返回（HTML5 事件）</li>
					<li>absort：嵌入元素停止下载时在 object 元素上触发</li>
					<li>error：iframe、img 或嵌入内容加载失败后触发，javascript 错误时在 window 触发</li>
					<li>resize：窗口大小改变时触发</li>
					<li>scroll：滚动带滑轮的元素时在元素上触发</li>
					<li>hashchange：网页 URL 改变时触发（HTML5 事件）</li>
				</ul>
			</p>
		</section>
		<section>
			<h2>焦点事件</h2>
			<p>
				常用的焦点事件包括：
				<ul>
					<li>blur：当元素失去焦点时触发（不会冒泡）</li>
					<li>focus：当元素获得焦点时触发（不会冒泡）</li>
					<li>focusout：当元素失去焦点时触发（会冒泡）</li>
					<li>focusin：当元素获得焦点时触发（会冒泡）</li>
				</ul>
				<input type="text"  id="focus" placeholder="点击后按 F12 ">
				<script type="text/javascript">
					var focus = document.getElementById('focus');
					focus.onblur = function() {
						console.log('blur');
					};
					focus.onfocus = function() {
						console.log('focus');
					};
					focus.onfocusout = function() {
						console.log('focusout');
					};
					focus.onfocusin = function() {
						console.log('focusin');
					};
				</script>
			</p>
		</section>
		<section>
			<h2>鼠标事件</h2>
			<p>
				常用的鼠标事件包括：
				<ul>
					<li>click：当元素被点击（左键）或回车时触发</li>
					<li>dblclick：当元素被双击（左键）时触发</li>
					<li>mousedown：当元素被点下（任意鼠标键）时触发</li>
					<li>mouseup：当鼠标按键被释放时触发</li>
					<li>mouseenter：当光标进入元素内触发（不冒泡），元素区域上方都算作内部</li>
					<li>mouseover：当光标进入元素内触发，不被子元素覆盖的区域上方才算内部</li>
					<li>mouseleave：当光标离开元素时触发（不冒泡），元素区域上方都算作内部</li>
					<li>mouseout：当光标离开元素时触发，不被子元素覆盖的区域上方才算内部</li>
					<li>mousemove：当光标在元素内移动时不断触发</li>
				</ul>
				<div id="mouse" style="height: 2em; background-color: #eee; text-align: center;">在此区域做尝试</div>
				<script type="text/javascript">
					var mouse = document.getElementById('mouse');
					mouse.onclick = function() { console.log('click') };
					mouse.ondblclick = function() { console.log('dblclick') };
					mouse.onmousedown = function() { console.log('mousedown') };
					mouse.onmouseup = function() { console.log('mouseup') };
					mouse.onmouseenter = function() { console.log('mouseenter') };
					mouse.onmouseover = function() { console.log('mouseover') };
					mouse.onmouseleave = function() { console.log('mouseleave') };
					mouse.onmouseout = function() { console.log('mouseout') };
					mouse.onmousemove = function() { console.log('mousemove') };
				</script>
				鼠标事件对象特有几个属性可以查看点击位置坐标：
				<ul>
					<li>clientX、clientY：相对于浏览器视窗</li>
					<li>pageX、pageY：相对于文档</li>
					<li>screenX、screenY：相对于显示器屏幕</li>
					<li>ctrlKey、shiftKey、altKey、metaKey：true 时表示触发事件时对应键盘键被按下</li>
					<li>button：按下鼠标哪个键（以下左键为主按钮，右键为次按钮）
						<ul>
							<li>IE8 及以前：
								<ul>
									<li>0：没有按下按钮</li>
									<li>1：按下左键</li>
									<li>2：按下右键</li>
									<li>3：按下左右键</li>
									<li>4：按下滑轮键</li>
									<li>5：按下左键和滑轮键</li>
									<li>6：按下右键和滑轮键</li>
									<li>7：按下左右和滑轮键</li>
								</ul>
							</li>
							<li>DOM
								<ul>
									<li>0：按下左键</li>
									<li>1：按下滑轮键</li>
									<li>2：按下右键</li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
				<input id="xy" type="button" name="tryXY" value="开启显示坐标">
				<script type="text/javascript">
					document.getElementById('xy').onclick = function() {
						this.value="按 F12 查看"
						document.onclick = function(event) {
							console.log("clientX = " + event.clientX);
							console.log("clientY = " + event.clientY);
							console.log("pageX = " + event.pageX);
							console.log("pageY = " + event.pageY);
							console.log("screenX= " + event.screenX);
							console.log("screenY = " + event.screenY);
						}
					}
				</script>
				<figure style="overflow: scroll;">
					<img id="eventXY" style="max-width: 100%;" src="../images/event_xy.jpg">
					<figcaption id="imgInfo" class="description">点击图片放大</figcaption>
				</figure>
				<style type="text/css">
					#eventXY {
						pointer: cursor;
					}
				</style>
				<script type="text/javascript">
					var flag = true;
					var imgInfo = document.getElementById('imgInfo');
					document.getElementById('eventXY').onclick = function() {
						if (flag) {
							this.style = '';
							imgInfo.innerHTML = '点击图片缩小';
							flag = !flag;
						} else {
							this.style.maxWidth = '100%';
							imgInfo.innerHTML = '点击图片放大';
							flag = !flag;
						}
					}
				</script>
			</p>
		</section>
		<section>
			<h2>键盘事件</h2>
			<p>
				常用的键盘事件包括：
				<ul>
					<li>keydown：当按下任意键盘按键时触发，按紧后重复触发</li>
					<li>keypress：当按下字符键或 Esc 键时触发，按紧后重复触发</li>
					<li>keyup：当释放键盘按键时触发</li>
				</ul>
				当用户按下一个按键后，其触发顺序为：keydown -> keypress -> 文本框字符出现 -> keyup
				<div>
					<input id="key" type="text" placeholder="按键盘键后按 F12">
				</div>
				<script type="text/javascript">
					var key = document.getElementById('key');
					key.onkeydown = function() {
						console.log('keydown');
					};
					key.onkeypress = function() {
						console.log('keypress');
					};
					key.onkeyup = function() {
						console.log('keyup');
					};
				</script>
				<ul>
					<li>
						对于 keydown 和 keyup 事件，在 IE 或 Chrome 中通过 event.keyCode ，在其他浏览器中通过 event.which ，在最新 DOM （IE9+）中通过 key 来获取按下哪个键盘键位。keyCode 和 which属性值为键盘键位字符编码，常用如下
						<ul>
							<li>48 ~ 57：数字 0 ~ 9</li>
							<li>65 ~ 90：字母 a（A） ~ z（Z）</li>
							<li>112 ~ 135：F1 ~ F24</li>
							<li>8：退格</li>
							<li>9：Tab</li>
							<li>13：回车</li>
							<li>20：大小写切换键</li>
							<li>32：空格</li>
							<li>37：左箭头</li>
							<li>38：上箭头</li>
							<li>39：右箭头</li>
							<li>40：下箭头</li>
						</ul>
						key 的值为对于键的名字。
					</li>
					<li>对于 keypress 事件，在 IE9+、Chrome、Firefox 中通过 evnet.charCode ，在 Safari 5 和 Chrome 中使用 keyIdentifier ，在最新 DOM 中使用 char  获取按下的键盘键位的 ASCII 值。</li>
				</ul>
			</p>
		</section>
		<section class="refer">
			<h2>参考文献</h2>
			<p>
				<div>[1] Javascript高级程序教程</div>
				<div>[2] calledT event.target 和event.currentTarget 的区别<a href="http://www.calledt.com/target-and-currenttarget/">http://www.calledt.com/target-and-currenttarget/</a></div>
			</p>
		</section>
	</article>
</body>
</html>