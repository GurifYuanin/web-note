<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="../css/normalize.css">
  <link rel="stylesheet" href="../css/styles/agate.css">
  <link rel="stylesheet" href="../css/dark.css">
  <script src="../js/jquery-3.2.1-compressed.js"></script>
  <script src="../js/highlight.pack.js"></script>
  <script src="../js/sidebar.js"></script>
  <title>Redis</title>
</head>

<body>
  <aside id="sidebar">
    <section id="catalog">
      <img id="hideCatalog" src="../images/catalog.png" alt="加载失败">
      目录
    </section>
  </aside>
  <div id="showCatalog">
    <img src="../images/arrow.png">
  </div>
  <article id="container">
    <hgroup>
      <h1 id="title">Redis</h1>
    </hgroup>
    <section>
      <h2>简介</h2>
      <p>
        redis 是 key-value 数据库，数据保存在内存上，因此可以实现高效存取。
      </p>
    </section>
    <section>
      <h2>安装并启动</h2>
      <p>
        <h3>macOS</h3>
        使用 HomeBrew 安装 redis，安装后启动服务。
        <pre><code class="shell">
# 安装 redis
$ brew install redis
# 启动服务
$ brew services start redis
# 查看已经启动的服务
$ brew services list
Name Status User Plist
redis started admin /Users/admin/Library/LaunchAgents/homebrew.mxcl.redis.plist
# 查看 plist（property list）文件获得 redis 配置文件
$ cat /Users/admin/Library/LaunchAgents/homebrew.mxcl.redis.plist
...
&lt;string&gt;/usr/local/etc/redis.conf&lt;/string&gt;
...
        </code></pre>
        使用 redis-server 命令启动 redis，既可以启动时通过传参的方式进行配置，也可以直接指定配置文件。
        <pre><code class="shell">
# 通过传参的形式启动 redis
$ redis-server --port 6379 --daemonize 'yes'

# 通过指定配置文件的方式启动 redis
$ redis-server /usr/local/etc/redis.conf
...
                _._                                                  
           _.-``__ ''-._                                             
      _.-``    `.  `_.  ''-._           Redis 5.0.4 (00000000/0) 64 bit
  .-`` .-```.  ```\/    _.,_ ''-._                                   
 (    '      ,       .-`  | `,    )     Running in standalone mode
 |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379
 |    `-._   `._    /     _.-'    |     PID: 28832
  `-._    `-._  `-./  _.-'    _.-'                                   
 |`-._`-._    `-.__.-'    _.-'_.-'|                                  
 |    `-._`-._        _.-'_.-'    |           http://redis.io        
  `-._    `-._`-.__.-'_.-'    _.-'                                   
 |`-._`-._    `-.__.-'    _.-'_.-'|                                  
 |    `-._`-._        _.-'_.-'    |                                  
  `-._    `-._`-.__.-'_.-'    _.-'                                   
      `-._    `-.__.-'    _.-'                                       
          `-._        _.-'                                           
              `-.__.-'                                
        </code></pre>
        上面显示了服务所在的端口和 pid，我们可以通过 redis-cli 命令连接到数据库（默认连接到 127.0.0.1:6379），然后进行动态修改配置：
        <pre><code class="shell">
$ redis-cli [-h host] [-p port] [-a password]
# 获得所有配置项
127.0.0.1:6379>CONFIG GET *
# 获得制定配置项
127.0.0.1:6379>CONFIG GET 配置项名
# 设置配置项
127.0.0.1:6379>CONFIG SET 配置项名 配置项值
        </code></pre>
        当遇到<span class="different">(error) ERR Unsupported CONFIG parameter:</span>错误时，说明该配置项不能进行动态修改，只能在启动前进行配置。
        <pre><code class="shell">

        </code></pre>
      </p>
    </section>
    <section>
      <h2>客户端与数据库</h2>
      <p>
        当使用 redis-cli 进行连接时，该行为便是一个客户端（client）连接到 redis 数据库。
        <h3>切换数据库</h3>
        redis 默认会开启 16 个数据库，每个数据库用一个编号表示，从 0 开始进行索引。
        <pre><code class="shell">
127.0.0.1:6379> SELECT index
        </code></pre>
        <h3>客户端操作</h3>
        <pre><code class="shell">
# 获得所有客户端信息
127.0.0.1:6379> CLIENT LIST
# 检查是否连接成功
127.0.0.1:6379> PING
# 断开当前客户端连接
127.0.0.1:6379> QUIT
# 断开指定客户端连接
127.0.0.1:6379> CLIENT KILL ip:port
        </code></pre>
        <h3>数据保存到磁盘</h3>
        <pre><code class="shell">
# 同步方式保存数据到磁盘上
127.0.0.1:6379> SAVE
# 异步方式保存数据到磁盘上
127.0.0.1:6379> BGSAVE
        </code></pre>
        <h3>时间</h3>
        <pre><code class="shell">
# 获得当前时间戳
127.0.0.1:6379> TIME
# 获得上次数据保存到磁盘的时间戳
127.0.0.1:6379> LASTSAVE
        </code></pre>
      </p>
    </section>
    <section>
      <h2>数据类型</h2>
      <p>
        redis 是 Key-Value 数据库，所有数据可以通过 key 来检索，value 有以下类型：
        <ul>
          <li>字符串</li>
          <li>Hash：哈希映射，key-value 键值对</li>
          <li>List：列表，字符串列表，元素允许重复</li>
          <li>Set：集合，字符串集合，元素不能重复</li>
          <li>ZSet：有序集合，带分数的字符串集合，分数为该字符串的顺序，元素不能重复</li>
        </ul>
        通过以下指令查询 key 的类型。
        <pre><code class="shell">
127.0.0.1:6379> TYPE key
        </code></pre>
        <h3>字符串</h3>
        <pre><code class="shell">
# 新增
127.0.0.1:6379> SET key value
# 获取
127.0.0.1:6379> GET key
        </code></pre>
        <h3>Hash</h3>
        <pre><code class="shell">
# 新增 field
127.0.0.1:6379> HSET key field value
# 获取 field 的值
127.0.0.1:6379> HGET key field
# 获得所有 field 的值
127.0.0.1:6379> HGETALL key
# 获得所有 field
127.0.0.1:6379> HKEYS key
# 删除 field
127.0.0.1:6379> HDEL key field
# 判断 field 是否存在
127.0.0.1:6379> HEXISTS key field
        </code></pre>
        <h3>List</h3>
        <pre><code class="shell">
# 新增一个元素
127.0.0.1:6379> LPUSH key value
# 设置 index 元素的值
127.0.0.1:6379> LSET key index value
# 移除一个元素
127.0.0.1:6379> LPOP key
# 获取列表第 index 个元素
127.0.0.1:6379> LINDEX key index
# 获取列表从 start 到 stop 的元素
127.0.0.1:6379> LRANGE key start stop
# 保留列表从 start 到 stop 的元素
127.0.0.1:6379> LTRIM key start stop
# 获得列表长度
127.0.0.1:6379> LLEN key
        </code></pre>
        <h3>Set</h3>
        push 和 pop 遵循后进先出的原则（栈）。
        <pre><code class="shell">
# 判断元素是否已经在集合内
127.0.0.1:6379> SISMEMBER key member
# 新增元素
127.0.0.1:6379> SADD key member
# 获取集合所有元素
127.0.0.1:6379> SMEMBERS key
# 移除集合内一个元素
127.0.0.1:6379> SREM key member
# 获得集合元素数量
127.0.0.1:6379> SCARD key
        </code></pre>
        <h3>ZSet</h3>
        <pre><code class="shell">
# 新增元素
127.0.0.1:6379> ZADD key score member
# 获得元素的分数
127.0.0.1:6379> ZSCORE key member
# 将元素按照分数进行排序，获得该元素的排名
127.0.0.1:6379> ZRANK key member
# 获取分数为 [start, stop] 之间的元素
127.0.0.1:6379> ZRANGEBYSCORE key min max
# 将元素按照分数进行排序，获得排名 start 到 stop 之间的元素
127.0.0.1:6379> ZRANGE key start stop
# 移除集合内元素
127.0.0.1:6379> ZREM key member
# 获得集合元素数量
127.0.0.1:6379> ZCARD key
        </code></pre>
      </p>
    </section>
    <section>
      <h2>通用操作</h2>
      <p>
        <h3>判断 key 是否存在</h3>
        <pre><code class="shell">
# 不存在：0
# 存在：1
127.0.0.1:6379> EXISTS key
        </code></pre>
        <h3>删除 key</h3>
        <pre><code class="shell">
# 删除指定 key
127.0.0.1:6379> DEL key
# 删除当前数据库所有 key
127.0.0.1:6379> FLUSHDB
# 删除所有数据库所有 key
127.0.0.1:6379> FLUSHALL
        </code></pre>

        <h3>查询过期时间</h3>
        <pre><code class="shell">
# 毫秒为单位
127.0.0.1:6379> PTTL key
# 秒为单位
127.0.0.1:6379> TTL key
        </code></pre>
        <h3>设置过期时间</h3>
        设置 key 后默认过期时间为无限，即不过期。
        <pre><code class="shell">
# 设置失败：0
# 设置成功：1
# seconds 秒后失效
127.0.0.1:6379> EXPIRE key seconds
# milliseconds 毫秒后失效
127.0.0.1:6379> PEXPIRE key milliseconds
# 在 timestamp 时间戳时失效
127.0.0.1:6379> EXPIREAT key timestamp
# 移除过期时间，使得 key 持久保存
127.0.0.1:6379> PERSIST key
        </code></pre>
        <h3>移动 key 所在数据库</h3>
        <pre><code class="shell">
127.0.0.1:6379> MOVE key index
        </code></pre>
        <h3>修改 key 名</h3>
        <pre><code class="shell">
127.0.0.1:6379> RENAME key new_key
        </code></pre>
        <div class="tip">
          指令大小写不敏感，因此既可以 GET key，也可以使用 get key 。
        </div>
      </p>
    </section>
    <section>
      <h2>发布与订阅</h2>
      <p>
        订阅者订阅频道，发布者在某个频道发布消息后，所有订阅者都会收到这个消息。
        <h3>订阅频道</h3>
        
        <pre><code class="shell">
127.0.0.1:6379> SUBSCRIBE channel
        </code></pre>
        <h3>取消订阅频道</h3>
        <pre><code class="shell">
127.0.0.1:6379> UNSUBSCRIBE channel
        </code></pre>
        <h3>向渠道发布消息</h3>
        <pre><code class="shell">
127.0.0.1:6379> PUBLISH channel message
        </code></pre>
        <div class="tip">
          channel 为渠道名，大小写敏感。
        </div>
      </p>
    </section>
    <section class="refer">
      <h2>参考文献</h2>
      <p>
        <div>[1] runoob redis <a
            href="https://www.runoob.com/redis/redis-tutorial.html">https://www.runoob.com/redis/redis-tutorial.html</a>
        </div>
        <div>[2] redis commands <a href="https://redis.io/commands">https://redis.io/commands</a></div>
      </p>
    </section>
  </article>
</body>

</html>